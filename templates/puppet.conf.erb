# <%= @config_path %>/puppet.conf
# Puppet configuration, managed through puppet::config, hiera variables,
# and the template puppet.conf.erb.

[main]
  <%- if @dns_alt_names && ! @dns_alt_names.empty? -%>
    dns_alt_names = <%= @dns_alt_names.join(', ') %>
  <%- end -%>
  <%- if @no_warnings && ! @no_warnings.empty? -%>
    disable_warnings = <%= @no_warnings.join(', ') %>
  <%- end -%>
  <%- if @extra_main && ! @extra_main.empty? -%>

    # extra lines, from extra_main
    <%= @extra_main.join("\n    ") %>
  <%- end -%>
<% if @agent -%>

[agent]
    certname    = <%= @certname %>
    environment = <%= @env %>
  <%- if @srv_domain -%>
    use_srv_records = true
    srv_domain  = <%= @server %>
  <%- else -%>
    server      = <%= @server %>
  <%- end -%>
  <%- if @ca_server != '' -%>
    ca_server   = <%= @ca_server %>
  <%- end -%>
    classfile   = $vardir/classes.txt
  <%- if @run_in_noop -%>
    noop        = true
  <%- end -%>
  <%- if @extra_agent && ! @extra_agent.empty? -%>

    # extra lines, from extra_agent
    <%= @extra_agent.join("\n    ") %>
  <%- end -%>

  <%- if @use_cache %>
    usecacheonfailure = true
  <%- else -%>
    usecacheonfailure = false
  <%- end -%>
<%- end -%>
<%- if @master -%>

[master]
    # Directory Environments
    environmentpath     = <%= @envdir %>
    environment_timeout = <%= @env_timeout %>
  <%- if @reports && ! @reports.empty? -%>

    # List of reports to run
    reports = <%= @reports.join(',') %>
  <%- end -%>

    ca          = <%= @is_ca ? "true" : "false" %>
  <%- if @is_ca && @autosign != '' -%>
    autosign    = <%= @autosign %>
  <%- end -%>
  <%- if @enc != '' -%>

    # Enable an External Node Classifier
    node_terminus  = exec
    external_nodes = <%= @enc %>
  <%- end -%>
  <%- if @use_puppetdb -%>

    # Enable the puppetdb
    storeconfigs         = true
    storeconfigs_backend = puppetdb
  <%- end -%>
  <%- if @reporturl != '' -%>

    reporturl = <%= @reporturl %>
  <%- end -%>
  <%- if @extra_master && ! @extra_master.empty? -%>

    # extra lines, from extra_master
    <%= @extra_master.join("\n    ") %>
  <%- end -%>
<%- end -%>
